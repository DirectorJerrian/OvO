# 1.引言

## 1.1文档标识（大致介绍下文档）

# 2.详细测试情况

## 2.1单元测试

### 2.1.10酒店搜索

#### 2.1.10.1用例代码

```java
@Test
    void getHotelTest(){
        List<HotelVO> hotelList=hotelMapper.selectQualifiedHotel("1343296078",3);
        HotelVO hotel=hotelList.get(0);
        assertEquals("神仙酒店",hotel.getName());
    }
```

#### 2.1.10.2用例说明

调用selectQualifiedHotel，获取目标酒店列表，由于目标酒店的商圈是唯一的，所以比较酒店列表第一位是否是“神仙酒店”，通过测试。

### 2.1.13录入可用客房

#### 2.1.13.1用例代码

```java
  @Test
    public void insertRoomInfoTest(){
        RoomVO roomVO=new RoomVO();
        roomVO.setCurNum(0);
        roomVO.setPrice(200.0);
        roomVO.setRoomType("Family");
        roomVO.setTotal(0);
        roomVO.setHotelId(3);
        roomService.insertRoomInfo(roomVO);
        List<HotelRoom> allRoom = roomService.retrieveHotelRoomInfo(3);
        List<String> allType=new ArrayList<>();
        for(HotelRoom item: allRoom){
            allType.add(String.valueOf(item.getRoomType()));
        }
        Assert.assertTrue(allType.contains("家庭房"));

    }
```

#### 2.1.13.2用例说明

调用insertRoomInfo，给id为3的酒店增加客房，增加成功。

### 2.1.14增加酒店

#### 2.1.14.1用例代码

```java
  @Test
      public void addHotelTest() throws ServiceException {
          HotelVO hotelVO=new HotelVO();
          hotelVO.setAddress("hululu");
          hotelVO.setBizRegion("XiDan");
          hotelVO.setDescription("欢迎您的光临，这里的风景很不错");
          hotelVO.setHotelStar("Five");
          hotelVO.setManagerId(1);
          hotelVO.setName("huLuLuTu");
          hotelService.addHotel(hotelVO);
          List<HotelVO> allHotel=hotelService.retrieveHotels();
          HotelVO target = new HotelVO();
          for(HotelVO item:allHotel){
              if(item.getName().equals("huLuLuTu")){
                  target=item;
              }
          }
          Assert.assertEquals(target.getBizRegion(),"XiDan");
          Assert.assertEquals((int)target.getManagerId(),1);
          Assert.assertEquals(target.getDescription(),"欢迎您的光临，这里的风景很不错");
          Assert.assertEquals(target.getHotelStar(),"Five");
      }
```

#### 2.1.14.2用例说明

调用addHotel，增加酒店并测试是否增加成功。

### 2.1.15删除酒店

#### 2.1.15.1用例代码

```java
  @Test
      public void deleteHotelTest() throws ServiceException {
          List<HotelVO> allHotel = hotelService.retrieveHotels();
          HotelVO target = new HotelVO();
          for (HotelVO item : allHotel) {
              if (item.getName().equals("huLuLuTu")) {
                  target = item;
              }
          }
          hotelService.deleteHotel(target.getId());
          List<Integer> allId = new ArrayList<>();
          for (HotelVO item : allHotel) {
                  allId.add(item.getId());
          }
              Assert.assertTrue(allId.contains(target.getId()));
      }
```

#### 2.1.15.2用例说明

调用deleteHotel，增加酒店并测试是否删除成功。

### 2.1.16添加优惠策略

#### 2.1.16.1用例代码

```java
   @Test
       public void addCouponTest(){
           HotelTargetMoneyCouponVO couponVO=new HotelTargetMoneyCouponVO();
           couponVO.setHotelId(1);
           couponVO.setName("test优惠券");
           couponVO.setDiscountMoney(100);
           couponVO.setTargetMoney(600);
           couponVO.setType(3);
           couponService.addHotelTargetMoneyCoupon(couponVO);
           List<Coupon> couponVOList=couponService.getHotelAllCoupon(1);
           Coupon coupon=new Coupon();
           for(Coupon item: couponVOList){
               if(item.getCouponName().equals("test优惠券")){
                   coupon=item;
                   break;
               }
           }
           Assert.assertEquals(coupon.getTargetMoney(),600,0.0);
           Assert.assertEquals(100, coupon.getDiscountMoney(), 0.0);
       }
```

#### 2.1.16.2用例说明

调用addHotelTargetMoneyCoupon，添加优惠策略并测试是否添加成功。

### 2.1.17删除订单

#### 2.1.17.1用例代码

```java
    @Test
       public void annulOrderTest(){
           User user=accountService.getUserInfo(5);
           OrderVO orderVO=new OrderVO();
           SimpleDateFormat sf = new SimpleDateFormat("yyyy-MM-dd");
           Date date = new Date(System.currentTimeMillis());
           String curdate = sf.format(date);
           orderVO.setCreateDate(curdate);
           orderVO.setCheckInDate(curdate);
           orderVO.setOrderState("已预订");
           orderVO.setUserId(5);
           orderVO.setPeopleNum(2);
           orderVO.setRoomNum(1);
           orderVO.setHotelId(1);
           orderVO.setPrice(200.0);
           orderVO.setClientName(user.getUserName());
           orderVO.setPhoneNumber(user.getPhoneNumber());
           Order order = new Order();
           BeanUtils.copyProperties(orderVO,order);
           orderMapper.addOrder(order);
           hotelService.updateRoomInfo(orderVO.getHotelId(),orderVO.getRoomType(),orderVO.getRoomNum());
           List<Order> allOrder=orderService.getHotelUserOrders(1,5);
           Order target=new Order();
           for(Order item: allOrder){
               if(item.getCreateDate().equals(curdate)) target=item;
           }
           System.out.println(target.getCheckInDate());
           orderService.annulOrder(target.getId());
           allOrder=orderService.getHotelUserOrders(1,5);
           Assert.assertFalse(allOrder.contains(target));
       }
```

#### 2.1.17.2用例说明

调用annulOrder，删除订单并测试删除是否成功。

### 2.1.18办理入住

#### 2.1.18.1用例代码

```java
 @Test
    public void executeOrderTest(){
            orderMapper.executeOrder(101);
            Order order=orderMapper.getOrderById(101);
            assertEquals("已入住",order.getOrderState());
            orderMapper.setOrderAdded(101);
    }
```

#### 2.1.18.2用例说明

调用executeOrder执行ID为101的订单，随后调用getOrderById获取101订单的信息，判断该订单的状态是否为“已入住”。

### 2.1.19异常订单处理

#### 2.1.19.1用例代码

```java
@Test
    public void handleStrangeOrderTest(){
        orderService.getAllOrders();
        orderMapper.annulOrder(102);
        Order order=orderMapper.getOrderById(102);
        assertEquals("已取消",order.getOrderState());
        orderMapper.setOrderAdded(102);
    }
```

#### 2.1.19.2用例说明

调用annulOrder取消ID为101的订单，随后调用getOrderById获取101订单的信息，判断该订单的状态是否为“已取消”。

### 2.1.20优惠策略添加

#### 2.1.20.1用例代码

```java
 @Test
    public void addVoucherTest(){
        Voucher voucher=new Voucher();
        voucher.setStatus("可使用");
        String description=String.valueOf(Math.random()*100000+10000);
        voucher.setDescription(description);
        voucher.setDiscount_money(123);
        voucher.setTarget_money(123);
        voucher.setDiscount(1);
        voucher.setUserId(4);
        voucherMapper.addVoucher(voucher);
        List<Voucher> allVoucher=voucherMapper.getUserVoucher(4);
        Voucher goal=new Voucher();        ;
        for(Voucher i:allVoucher){
            if(i.getDescription().equals(description)) {
                goal=i;
                break;
            }
        }
        assertNotNull(goal.getId(),"goal is needed here");
        assertEquals(123,(int)goal.getDiscount_money());
        assertEquals(123,(int)goal.getTarget_money());
        assertEquals(1,(int)goal.getDiscount());
        assertEquals(4,(int)goal.getUserId());

    }
```

#### 2.1.20.2用例说明

首先设置voucher的属性，随机生成一个独特的优惠券描述，通过调用addVoucher将优惠券加入数据库。调用addVoucherToAll将优惠券发给用户，调用getUserVoucher，将与相同优惠券描述的优惠券赋值给goal，最终判断goal的ID是否为null，不为null,则再判断优惠券的属性是否正确，测试通过。

### 2.1.21信用充值

#### 2.1.21.1用例代码

```java
@Test
    public void creditTest(){
        int credit=(int)Math.random()*1000+100;
        accountMapper.updateUserCredit(4,credit);
        User user=accountMapper.getAccountById(4);
        assertEquals(credit,user.getCredit());
    }
```

#### 2.1.21.2用例说明

调用updateUserCredit将用户ID为4的信用值改为一个随机数，随后调用getAccountById获取用户信息，判断该用户的信用值是否是设置的随机数，测试通过。

### 2.1.22用户管理

#### 2.1.22.1用例代码

```java
@Test
    public void addManagerTest(){
        User user=new User();
        String randomEmail=String.valueOf((int)(Math.random()*90000+10000))+"@qq.com";
        user.setEmail(randomEmail);
        user.setPassword("123456");
        user.setUserType(UserType.HotelManager);
        adminMapper.addManager(user);
        User manager=accountMapper.getAccountByName(randomEmail);
        assertNotNull(manager);
    }
```

#### 2.1.22.2用例说明

设置userForm的属性，来设置新酒店工作人员的账号和密码，调用addManager将该账号加入数据库。调用getAccountById获取刚添加账号的信息，判断该账号是否为空，测试通过。

## 2.2集成测试

### 2.2.10酒店搜索

#### 2.2.10.1用例代码

```java
@Test
    public void hotelSearchTest(){
        HotelSearchVO hotelSearchVO=new HotelSearchVO();
        hotelSearchVO.setHotelName("汉庭酒店");
        hotelSearchVO.setStar(0);
        hotelSearchVO.setRate(0);
        hotelSearchVO.setRoomType("DoubleBed");
        hotelSearchVO.setBizRegion("XiDan");
        List<HotelVO> hotellist=hotelService.hotelSearch(hotelSearchVO);
        assertEquals(1,hotellist.size());
        assertEquals("汉庭酒店",hotellist.get(0).getName());
    }
```

#### 2.2.10.2用例说明

通过设置hotelSearchVO的属性，限制搜索酒店的条件。调用hotelSearch函数，搜索数据库内的目标酒店，最终比较搜索结果与预想结果，测试通过。

### 2.2.13录入可用客房

#### 2.2.13.1用例代码

```java
   @Test
      void insertRoom() {
          RoomVO roomVO = new  RoomVO();
          roomVO.setHotelId(3);
          roomVO.setTotal(3);
          roomVO.setRoomType("DoubleBed");
          roomVO.setPrice(200.0);
          roomVO.setCurNum(2);
          Assert.assertEquals(1,roomMapper.insertRoom(roomVO));
      }
```

#### 2.1.13.2用例说明

调用insertRoom，给id为3的酒店增加客房，若返回值为1增加成功。

### 2.2.14增加酒店

#### 2.2.14.1用例代码

```java
 @Test
     void insertHotel() {
         Hotel hotel = new Hotel();
         hotel.setHotelName("OvO酒店");
         hotel.setManagerId(1);
         hotel.setHotelStar(HotelStar.Five);
         BeanUtils.copyProperties(hotel,hotel);
         Assert.assertEquals(1, hotelMapper.insertHotel(hotel));
     }
```

#### 2.2.14.2用例说明

调用insertHotel，增加酒店，若返回值为1则增加成功。

### 2.2.15删除酒店

#### 2.2.15.1用例代码

```java
   @Test
      void deleteHotel() {
          int id = hotelMapper.findHotel("OvO酒店");
          Assert.assertEquals(hotelMapper.deleteHotel(id),1);
      }
```

#### 2.2.15.2用例说明

调用deleteHotel，若返回值为1则删除成功。

### 2.2.16添加优惠策略

#### 2.2.16.1用例代码

```java
    @Test
       void insertCoupon() {
           Coupon coupon = new Coupon();
           coupon.setCouponName("test优惠券");
           coupon.setCouponType(3);
           coupon.setDescription("测试添加优惠策略是否正常");
           Assert.assertEquals(1, couponMapper.insertCoupon(coupon));
       }
```

#### 2.2.16.2用例说明

调用insertCoupon，添加优惠策略，若返回值为1则删除成功。

### 2.1.17删除订单

#### 2.1.17.1用例代码

```java
    @Test
       public void annulOrderTest(){
           User user=accountService.getUserInfo(5);
           OrderVO orderVO=new OrderVO();
           SimpleDateFormat sf = new SimpleDateFormat("yyyy-MM-dd");
           Date date = new Date(System.currentTimeMillis());
           String curdate = sf.format(date);
           orderVO.setCreateDate(curdate);
           orderVO.setCheckInDate(curdate);
           orderVO.setOrderState("已预订");
           orderVO.setUserId(5);
           orderVO.setPeopleNum(2);
           orderVO.setRoomNum(1);
           orderVO.setHotelId(1);
           orderVO.setPrice(200.0);
           orderVO.setClientName(user.getUserName());
           orderVO.setPhoneNumber(user.getPhoneNumber());
           Order order = new Order();
           BeanUtils.copyProperties(orderVO,order);
           orderMapper.addOrder(order);
           hotelService.updateRoomInfo(orderVO.getHotelId(),orderVO.getRoomType(),orderVO.getRoomNum());
           List<Order> allOrder=orderService.getHotelUserOrders(1,5);
           Order target=new Order();
           for(Order item: allOrder){
               if(item.getCreateDate().equals(curdate)) target=item;
           }
           System.out.println(target.getCheckInDate());
           orderService.annulOrder(target.getId());
           allOrder=orderService.getHotelUserOrders(1,5);
           Assert.assertFalse(allOrder.contains(target));
       }
```

#### 2.1.17.2用例说明

调用annulOrder，删除订单并测试删除是否成功。

### 2.2.18办理入住

#### 2.2.18.1用例代码

```java
@Test
    public void executeOrderTest(){
        orderMapper.setOrderAdded(1);
        orderService.executeOrder(1);
        Order target=orderMapper.getOrderById(1);
        assertEquals("已入住",target.getOrderState());
    }
```

#### 2.2.18.2用例说明

通过调用executeOrder函数，执行数据库中ID为1的订单，该订单为已预定状态，函数执行后，从数据库去除该订单信息，最终比较订单状态是否为“已入住”，测试通过。

### 2.2.19异常订单处理

#### 2.2.19.1用例代码

```java
@Test
    public void handleStrangeOrderTest(){
        orderService.getAllOrders();
        orderService.restoreOrder(2);
        Order target=orderMapper.getOrderById(2);
        assertEquals("已入住",target.getOrderState());
        orderService.getAllOrders();
        orderMapper.updateOverTimeOrder(2);
        orderService.revokeOrder(2);
        target=orderMapper.getOrderById(2);
        assertEquals("已取消",target.getOrderState());
    }
```

#### 2.2.19.2用例说明

在sql文件中，向数据库加入一条订单。通过调用getAllOrders获取所有订单，来刷新订单状态，将加入数据库的订单状态置为异常。随后调用restoreOrder恢复订单状态，比较订单状态是否为“已入住”。接着将订单状态置为异常，调用revokeOrder取消订单，比较订单状态是否为“已取消”，测试通过。

### 2.2.20优惠策略添加

#### 2.2.20.1用例代码

```java
@Test
    public void addVoucherTest(){
        Voucher voucher=new Voucher();
        voucher.setStatus("可使用");
        String description=String.valueOf(Math.random()*100000+10000);
        voucher.setDescription(description);
        voucher.setDiscount_money(123);
        voucher.setTarget_money(123);
        voucher.setDiscount(1);
        voucherService.addVoucher(voucher);
        List<Voucher> allVoucher=voucherService.getAllVoucher();
        Voucher goal=new Voucher();
        for(Voucher i:allVoucher){
            if(i.getDescription().equals(description)) {
                goal=i;
                break;
            }
        }
        assertNotNull(goal.getId(),"goal is needed here");
        assertEquals(123,(int)goal.getDiscount_money());
        assertEquals(123,(int)goal.getTarget_money());
        assertEquals(1,(int)goal.getDiscount());
        voucherService.addVoucherToAll(voucher);
        List<Voucher> voucherList=voucherService.getUserVoucher(4);
        Voucher goalVoucher=new Voucher();
        for(Voucher i:voucherList){
            if(i.getDescription().equals(description)){
                goalVoucher=i;
                break;
            }
        }
        assertNotNull(goalVoucher.getId());
    }
```

#### 2.2.20.2用例说明

首先设置voucher的属性，随机生成一个独特的优惠券描述，通过调用addVoucher将优惠券加入数据库。调用getAllVoucher取出所有优惠券，比较优惠券描述，若有与添加优惠券相同描述的优惠券，则将其赋值给goal，比较该优惠券属性，与先前添加优惠券属性是否相同。调用addVoucherToAll将优惠券发给用户，调用getUserVoucher，将与相同优惠券描述的优惠券赋值给goal，最终判断goal的ID是否为null，测试通过。

### 2.2.21信用充值

#### 2.2.21.1用例代码

```java
@Test
    public void depositCreditTest(){
        User user=accountService.getUserInfo(4);
        double beforeCredit=user.getCredit();
        marketingStaffService.creditCharge(user.getEmail(),user.getPhoneNumber(),100);
        user=accountService.getUserInfo(4);
        assertEquals(beforeCredit+1000,user.getCredit());
    }
```

#### 2.2.21.2用例说明

先调用getUserInfo，获取ID为4的用户信息，得到用户当前的信用值。调用creditCharge，为用户充值100，接着再调用getUserInfo获取新的信用值，最终比较旧的信用值加1000是否与新的信用值相等，测试通过。

### 2.2.22用户管理

#### 2.2.22.1用例代码

```java
@Test
    public void addManagerTest(){
        UserForm userForm=new UserForm();
        String randomEmail=String.valueOf((int)(Math.random()*9000+1000))+"@qq.com";
        userForm.setEmail(randomEmail);
        userForm.setPassword("123456");
        adminService.addManager(userForm);
        User user=accountService.getUserInfo(randomEmail);
        assertNotNull(user,"user here is required");
        assertEquals(UserType.HotelManager,user.getUserType());
    }
```

#### 2.2.22.2用例说明

设置userForm的属性，来设置新酒店工作人员的账号和密码，调用addManager将该账号加入数据库。调用getUserInfo获取刚添加账号的信息，判断该账号是否为空，不为空，则再判断该该账号类型是否是HotelManager，测试通过。

## 2.3功能测试

### 2.3.3优惠策略添加

#### 2.3.3.1用例代码

```java
@Test
    public void test() throws InterruptedException {
        browser.get(url);
        loginAsUser();
        browser.findElement(By.xpath("//*[@id=\"layout\"]/div[1]/ul/li[6]/a")).click();
        browser.findElement(By.xpath("//*[@id=\"layout\"]/div[2]/div[1]/div[3]/div[1]/div[3]/div/div/div/div/div/table/tbody/tr/td[7]/span/button[2]")).click();
        Thread.sleep(1000);
        browser.switchTo().activeElement();
        browser.findElement(By.xpath("/html/body/div[2]/div/div[2]/div/div[2]/div[2]/div[1]/button")).click();
        browser.switchTo().activeElement();
        browser.findElement(By.id("addCouponModal_couponType")).click();
        browser.findElement(By.name("3")).click();
        browser.findElement(By.xpath("//*[@id=\"addCouponModal_couponName\"]")).sendKeys("满减test优惠券");
        browser.findElement(By.xpath("//*[@id=\"addCouponModal_description\"]")).sendKeys("这里是为了test前端代码正确性");
        browser.findElement(By.xpath("//*[@id=\"addCouponModal_target_money\"]")).sendKeys("500");
        browser.findElement(By.xpath("//*[@id=\"addCouponModal_discount_money\"]")).sendKeys("100");
        browser.findElement(By.xpath("//*[@id=\"addCoupon\"]/div[2]/div/div[2]/div[3]/div/button[2]")).click();
        browser.switchTo().activeElement();
        browser.findElement(By.xpath("//*[@id=\"layout\"]/div[2]/div[1]/div[3]/div[1]/div[3]/div/div/div/div/div/table/tbody/tr/td[7]/span/button[2]")).click();
        browser.switchTo().activeElement();
        Assert.assertEquals("这里是为了test前端代码正确性",browser.findElement(By.xpath("/html/body/div[2]/div/div[2]/div/div[2]/div[2]/div[2]/div/div/div/div/div/table/tbody/tr[5]/td[3]")).getText());
    }
```



#### 2.3.4.2用例说明

模拟浏览器操作，进入酒店工作人员的优惠券添加界面，填写优惠券模板信息，确认添加后，比较新增的优惠券信息是否与浏览器中填写的信息相同。测试通过。

### 2.3.4优惠券添加

#### 2.3.4.1用例代码

```java
@Test
    public void test() throws InterruptedException{
        browser.get(url);
        loginAsMarketingStaff();
        browser.findElement(By.xpath("//*[@id=\"layout\"]/div[1]/ul/li[6]/a")).click();
        browser.findElement(By.xpath("//*[@id=\"layout\"]/div[2]/div/div[3]/div/div[2]/button")).click();
        browser.findElement(By.xpath("//*[@id=\"addVoucherModal_description\"]")).sendKeys("this is a voucher");
        browser.findElement(By.xpath("//*[@id=\"addVoucherModal_target_money\"]")).sendKeys("300");
        browser.findElement(By.xpath("//*[@id=\"addVoucherModal_discount_money\"]")).sendKeys("200");
        browser.findElement(By.xpath("//*[@id=\"addVoucherModal_discount\"]")).sendKeys("1");
        browser.findElement(By.xpath("//*[@id=\"addVoucherModal_number\"]")).sendKeys("1");
        browser.findElement(By.xpath("/html/body/div[2]/div/div[2]/div/div[2]/div[3]/div/button[2]")).click();
        String description=browser.findElement(By.xpath("//*[@id=\"layout\"]/div[2]/div/div[3]/div/div[3]/div/div/div/div/div/table/tbody/tr[2]/td[3]")).getText();
        String target_money=browser.findElement(By.xpath("//*[@id=\"layout\"]/div[2]/div/div[3]/div/div[3]/div/div/div/div/div/table/tbody/tr[2]/td[4]")).getText();
        String discount_money=browser.findElement(By.xpath("//*[@id=\"layout\"]/div[2]/div/div[3]/div/div[3]/div/div/div/div/div/table/tbody/tr[2]/td[5]")).getText();
        assertEquals("this is a voucher",description);
        assertEquals("300",target_money);
        assertEquals("200",discount_money);
        browser.findElement(By.xpath("//*[@id=\"layout\"]/div[2]/div/div[3]/div/div[3]/div/div/div/div/div/table/tbody/tr[2]/td[6]/span/button")).click();
        browser.findElement(By.xpath("/html/body/div[4]/div/div/div/div[2]/div/div[2]/button[2]")).click();
        Thread.sleep(1000);
        List<Voucher> voucherList=voucherMapper.getUserVoucher(4);
        Voucher voucher=voucherList.get(0);
        assertEquals("this is a voucher",voucher.getDescription());
        assertEquals(300,(int)voucher.getTarget_money());
        assertEquals(200,(int)voucher.getDiscount_money());
    }
```



#### 2.3.4.2用例说明

模拟浏览器操作，进入酒店营销人员的优惠券添加界面，填写优惠券模板信息，确认添加后，将优惠券发给所有客户。调用getUserVoucher获取用户的优惠券信息，比较优惠券信息是否与浏览器中填写的信息相同。测试通过。

# 3.其他

## 3.1文档修改历史

|  修改时间  | 修改人 |                           修改内容                           |
| :--------: | :----: | :----------------------------------------------------------: |
| 2020-06-28 |  巫夷  | 完成酒店搜索、办理入住、异常订单处理功能测试、优惠策略添加、信用充值等用例相关文档 |
| 2020-06-29 | 赵睿豪 | 更新订单评价、会员注册、会员充值、查看优惠券、个人基本信息管理、维护酒店基本信息用例相关的测试文档，并更新优惠券添加相关功能测试 |
|            |        |                                                              |

